// var testingArray = [
//     "24-7 Intouch",
//     "A&T Ascension Consulting Inc",
//     "ACD Direct",
//     "AGR Group",
//     "ARC Management Group",
//     "ARCSmart Solutions",
//     "AW Companies Inc",
//     "Adentcom S de RL de CV",
//     "Advensus",
//     "Agents Republic",
//     "Akorbi",
//     "AlfredoTest",
//     "Alliance DMS Inc",
//     "Allied Customer Solutions",
//     "Allied Global",
//     "AmeeraTel",
//     "American Customer Care",
//     "American Help Desk",
//     "Ameridial Inc",
//     "Ansafone Contact Centers",
//     "AnswerNet Inc",
//     "Aptitude 360 Inc",
//     "Argo ITC",
//     "Axion Contact",
//     "Azpired",
//     "BDO Esnad",
//     "BPO Centers",
//     "Barrister Global Services Network Inc",
//     "Bellsystem24Hoasao",
//     "Bill Gosling Outsourcing",
//     "Blake and Associates Holdings (Pty) Ltd",
//     "Boomerang SA",
//     "Bosch",
//     "Business and Consumer Choices Telemarketing Ltd",
//     "Buwelo",
//     "CC Capital Group",
//     "CCB Credit Services",
//     "CCI Mauritius Limited",
//     "CCI Systems Inc",
//     "CCIG Group",
//     "CNM BPO Solutions",
//     "CSS Corp",
//     "CTC TeleServices",
//     "Calibrus Call Center Services LLC",
//     "California Marketing Group",
//     "Call 4 Health",
//     "Call Center Services International",
//     "Call Zilla",
//     "Caribbean Contact Center",
//     "Cati Call Center",
//     "Cebu Tele-net Philippines Corp",
//     "Centris",
//     "Cir Tech",
//     "Clear Nexus",
//     "CloudTask",
//     "Cloudstaff",
//     "CogentHub",
//     "Collective Solution International",
//     "Comdata Group UK Limited",
//     "Company Voice LLC",
//     "Contact Centers Dominicana",
//     "Contact Resolution Inc",
//     "Contact Source Solutions LLC",
//     "ContactPoint 360",
//     "ContactWorks",
//     "Contacto GCS",
//     "Conversion Calls LLC",
//     "Corporate Technologies Advantage",
//     "Costa Rica Call Center",
//     "Credit Solutions Services Pty Limited",
//     "Cuentame SA",
//     "Cuore Group",
//     "Customer Contact Services",
//     "Customer Direct",
//     "DG Solutions",
//     "Datamark Incorporation",
//     "DialAmerica Marketing Inc",
//     "Dialog One",
//     "Direct Interactions Inc",
//     "Direct Marketing Partners",
//     "Disabled Veterans Call Center",
//     "Distressed Assets S.A.",
//     "Dominion Outsourcing",
//     "Dynamics Marketing Inc",
//     "ECE Contact Centers",
//     "EGS Global, Inc.",
//     "EMERGIA CUSTOMER CARE COLOMBIA SAS",
//     "EMS Inc",
//     "Eagle One",
//     "Ecco Group USA",
//     "Elevation Connect LLC",
//     "Ellora Telecom Philippines Inc",
//     "Emerge BPO",
//     "Empire One Global Solutions",
//     "Endicott Contact Centers",
//     "Etech",
//     "Eteleconnect Inc",
//     "Euro Interactive International",
//     "Everise LLC",
//     "Expivia",
//     "FM Outsource",
//     "Feesible Solutions LLC",
//     "First Call Resolution LLC",
//     "Five Star Call Center",
//     "Focus Services",
//     "Fusion BPO Services",
//     "FutureNow Technologies Inc",
//     "GGA Solutions",
//     "GLOBAL OUTSOURCING SOLUTIONS",
//     "GMS Connect",
//     "Gandalf IT Services LLP",
//     "General Revenue Corporation",
//     "Global Contact Services",
//     "Global Innovation Services",
//     "Global One Strategies",
//     "Global Remote Services SRL",
//     "Global Response",
//     "Global Virtuoso",
//     "GlowTouch Technologies",
//     "Grand Solutions",
//     "Great Falls Marketing",
//     "Grindstone Inc",
//     "Halloween Times",
//     "Hexaware Technologies Limited",
//     "Highlander Political Strategies",
//     "Humach",
//     "Human Call Centers LLC",
//     "IO Solutions Call Center Inc",
//     "ITM Marketing",
//     "Ideal Contact Center",
//     "Infinity",
//     "Infinity Brands",
//     "Infinity Support Group",
//     "InfoCision",
//     "Insight Communications",
//     "Invictus Solutions Limited",
//     "ItelBPO Solutions",
//     "J Teleconnections",
//     "J-Curve Technologies",
//     "Jindal Intellicom",
//     "KM2 Solutions",
//     "KocharTech",
//     "Konecta Argentina",
//     "Konecta Portugal",
//     "Konecta Spain",
//     "Landau Group",
//     "Leading Edge Connections",
//     "LinkActiv",
//     "Live Reps Call Center",
//     "LiveOps",
//     "MCI",
//     "Mango5",
//     "Marketing Alternatives Inc",
//     "MattsenKumar LLC",
//     "Mindpearl",
//     "Mount Healthcare Services",
//     "Mountain Valley Integrated Solutions",
//     "Multi Source Global Network Inc",
//     "Multiactivitati SRL",
//     "MySource LLC",
//     "NOVASORS",
//     "NexRep LLC",
//     "Next Door Solutions",
//     "OPSIFY",
//     "Office Beacon",
//     "OfficePartners360",
//     "OnQ Contact Center",
//     "One Contact Center Inc",
//     "OneLink Holdings SA",
//     "OneTouch Direct",
//     "Open Access BPO",
//     "Open Look",
//     "OptimumCX LLC",
//     "Options Marketing Group",
//     "Oregon Corrections Enterprises",
//     "OutPLEX",
//     "PERFORMATEL",
//     "Pena4 BPO",
//     "Perfect Pitch Technologies",
//     "PharmaCentra",
//     "PharmaKinnex Inc",
//     "Pondera Services LLC",
//     "Premier BPO",
//     "ProCom LLC",
//     "Promocall",
//     "Promoveo LLC",
//     "Protel",
//     "Proximo",
//     "Quality Contact Solutions Inc",
//     "Quality Customer Service & Sales Inc",
//     "RDI Corporation Inc",
//     "ROI Call Center Solutions",
//     "Radial",
//     "Radius Global Solutions",
//     "Raya Contact Center",
//     "Regalix Inc",
//     "Revenue Group",
//     "SRG Asia Pacific Sdn B",
//     "Segoso Caribbean",
//     "Sequence Health",
//     "Sibling Solutions",
//     "Simetrix Solutions LLC",
//     "Simply Contact Ltd",
//     "SinglePoint Group International",
//     "SkyCom Call Center",
//     "Skybridge Americas Inc",
//     "Smart Connect Outsourcing Solutions",
//     "Solvo Global",
//     "Stafford Communications",
//     "Stateside BPO",
//     "Support Services Group Call Center",
//     "TK Enterprises Inc",
//     "TMP Direct Inc",
//     "TSD Global",
//     "TalentWorldGroup Plc",
//     "Talk Americas",
//     "Tech Americas USA",
//     "TechMahindra",
//     "Techcel Outsourcing LLC",
//     "TeleSpeak",
//     "Telecontacto",
//     "Telepoint Communications",
//     "Tell2Tell",
//     "The Connection",
//     "The Heller Group",
//     "The Office Gurus",
//     "The Stride Center",
//     "Transparent BPO",
//     "Tri Source International",
//     "Tyme Global Technologies",
//     "UAssistMe",
//     "US4 IT SUPPORT LLC",
//     "Ujet Inc",
//     "Underguard Teleservices",
//     "Unido Digital",
//     "Unifin, Inc.",
//     "United Language Group",
//     "United Nearshore Operations",
//     "Universal Portfolio LLC",
//     "VANAD CONTACT CENTERS NEDERLAND BV",
//     "VSA Inc",
//     "Ver A Fast",
//     "Verticalops",
//     "Virtual Staffing",
//     "Visaya KPO",
//     "VivaCALL",
//     "Voysus Connection Experts Inc",
//     "Vsynergize Outsourcing Pvt Ltd",
//     "WE Marketing",
//     "Working Access Solutions Inc",
//     "Working Solutions",
//     "World Connection",
//     "Zero Variance",
//     "active contact",
//     "iCall Services Inc",
//     "iContact BPO",
//     "sds"
// ]


// var initialSAArray = ["AW Companies Inc",
//     "ARCSmart Solutions",
//     "A&T Ascension Consulting Inc",
//     "24-7 Intouch",
//     "ACD Direct",
//     "AGR Group",
//     "ARC Management Group",
//     "Adentcom S de RL de CV",
//     "Advensus",
//     "Agents Republic",
//     "Akorbi",
//     "AlfredoTest"];  

//     var initialSBSArray = ["AW Companies Inc",
//     "ARCSmart Solutions",
//     "A&T Ascension Consulting Inc",
//     "24-7 Intouch",
//     "ACD Direct",
//     "AGR Group",
//     "ARC Management Group",
//     "Adentcom S de RL de CV",
//     "Advensus",
//     "Agents Republic"];

// var initialCCSArray = ["AW Companies Inc",
// "ARCSmart Solutions",
// "A&T Ascension Consulting Inc",
// "24-7 Intouch",
// "ACD Direct",
// "AGR Group",
// "ARC Management Group",
// "Adentcom S de RL de CV",
// "Advensus"];


// var initialSVSFArray = ["AW Companies Inc",
// "ARCSmart Solutions",
// "A&T Ascension Consulting Inc",
// "24-7 Intouch",
// "ACD Direct",
// "AGR Group"];

// var initialCAArray = ["24-7 Intouch"];




var moduleName = "";
var recordId = "";
var dealName = "";
var allRecordData = {};
var pageNumber = 1;
var partnerNameArray = [];
var selectedPartnersArray = [];
var cAArray = [];
var sVSFArray = [];
var cCSArray = [];
var sBSArray = [];
var sAArray = [];
var elRow = []
var allSelectedArray = [];
var initialSelectedArray = [];
var initialSAArray = [];  
var initialSBSArray = [];
var initialCCSArray = [];
var initialSVSFArray = [];
var initialCAArray = [];


//################################################
//PROD VERSION V2 BELOW
//################################################
ZOHO.embeddedApp.on("PageLoad", entity => {
    ZOHO.CRM.UI.Resize({height:"1200",width:"1200"}).then(function(data){
        console.log(data);
    });
    var moduleName = entity.Entity;
    var recordId = entity.EntityId; 
    ZOHO.CRM.API.getRecord({Entity: moduleName, RecordID: recordId})
    .then(function (recordData) {
        recordData = recordData.data[0];
        dealName = recordData.Deal_Name;
        document.getElementById("oppId").value = recordData.id;
        allRecordData = recordData;
        var salesApproved = recordData.Sales_Approved_Partners;
        var sbsSelected = recordData.Partner_Search_Results;
        var conferenceCallSelected = recordData.Conference_Call_Selected_Partners;
        var siteVisitSelected = recordData.Client_Selected_Partner;
        var clientApproved = recordData.Correct_Client_Approved_Vendors;
        if(salesApproved.length > 0){
            for(i=0;i<salesApproved.length;i++)
            {
                initialSAArray.push(salesApproved[i])
            }
        }
        else
        {

        }
        if(sbsSelected.length > 0){
            for(i=0;i<sbsSelected.length;i++)
            {
                initialSBSArray.push(sbsSelected[i])
            }
        }
        else
        {
            
        }
        if(conferenceCallSelected.length > 0){
            for(i=0;i<conferenceCallSelected.length;i++)
            {
                initialCCSArray.push(conferenceCallSelected[i])
            }
        }
        else
        {
            
        }
        if(siteVisitSelected.length > 0){
            for(i=0;i<siteVisitSelected.length;i++)
            {
                initialSVSFArray.push(siteVisitSelected[i])
            }
        }
        else
        {
            
        }
        if(clientApproved.length > 0){
            for(i=0;i<clientApproved.length;i++)
            {
                initialCAArray.push(clientApproved[i])
            }
        }
        else
        {
            
        }
        getPartners();
    });    
});

ZOHO.embeddedApp.init();



function getPartners() {
    ZOHO.CRM.API.searchRecord({Entity:"Vendors",Type:"criteria",Query:"(Status:equals:CCCA Executed)",per_page:200,page:pageNumber})
    .then(function(response){
        var allPartnerRecs = response.data;
        allPartnerRecs.forEach(obj => {
            partnerNameArray.push(obj.Vendor_Name);
        });
        if(response.info.more_records == true)
        {
            pageNumber += 1;
            return getPartners();
        }
        else
        {
            createPartnerTable();
        }
    });
};


//createPartnerTable();



function createPartnerTable() {
    partnerNameArray.sort();
    if(initialSAArray.length > 0)
    {
        initialSAArray.forEach(element => {
            sAArray.push(element)
            if(initialSelectedArray.includes(element) == false)
            {
                allSelectedArray.push(element)
                partnerNameArray.splice(partnerNameArray.indexOf(element),1)
                partnerNameArray.unshift(element)
            }
        })
    }

    if (initialSBSArray.length > 0)
    {
        initialSBSArray.forEach(element => {
            sBSArray.push(element)
            if(initialSelectedArray.includes(element) == false)
            {
                allSelectedArray.push(element)
                partnerNameArray.splice(partnerNameArray.indexOf(element),1)
                partnerNameArray.unshift(element)
            }
        })    
    }

    if (initialCCSArray.length > 0)
    {
        initialCCSArray.forEach(element => {
            cCSArray.push(element)
            if(initialSelectedArray.includes(element) == false)
            {
                allSelectedArray.push(element)
                partnerNameArray.splice(partnerNameArray.indexOf(element),1)
                partnerNameArray.unshift(element)
            }
        })    
    }

    if (initialSVSFArray.length > 0)
    {
        initialSVSFArray.forEach(element => {
            sVSFArray.push(element)
            if(initialSelectedArray.includes(element) == false)
            {
                allSelectedArray.push(element)
                partnerNameArray.splice(partnerNameArray.indexOf(element),1)
                partnerNameArray.unshift(element)
            }
        })    
    }

    if (initialCAArray.length > 0)
    {
        initialCAArray.forEach(element => {
            cAArray.push(element)
            if(initialSelectedArray.includes(element) == false)
            {
                allSelectedArray.push(element)
                partnerNameArray.splice(partnerNameArray.indexOf(element),1)
                partnerNameArray.unshift(element)
            }
            
        })    
    }
    var resTableBody = document.getElementById("responseTableBody");
    for (let i = 0; i < partnerNameArray.length; i++){
        var newRow = document.createElement("TR");
        var newCheckCol = document.createElement("TH");
        var newCheckDiv = document.createElement("div");
        var newCheck = document.createElement("input");
        var newLabel = document.createElement("label");
        newCheckCol.setAttribute("class","partnerColNum5");
        newCheckDiv.setAttribute("class","checkboxDiv");
        newLabel.setAttribute("class","checkboxLabel");
        newCheck.setAttribute("class","form-check-input selectAllCheckbox");
        newCheck.setAttribute("type","checkbox");
        newCheck.setAttribute("id","flexCheckDefault");
        newCheckDiv.appendChild(newCheck);
        newCheckDiv.appendChild(newLabel);
        newCheckCol.appendChild(newCheckDiv);
        newRow.appendChild(newCheckCol);
        resTableBody.appendChild(newRow);
        for(let x = 0; x < 5; x++){
            var newCol = document.createElement("TH");
            newCol.setAttribute("class","partnerColNum" + x);
            newCol.innerHTML = partnerNameArray[i];
            newRow.setAttribute("class","partnerRow");
            newRow.appendChild(newCol);
            resTableBody.appendChild(newRow);
            if(cAArray.includes(partnerNameArray[i]) == true && newCol.className == "partnerColNum4")
            {
                newCol.classList.add("partner-selected")
            }
            if(sVSFArray.includes(partnerNameArray[i]) == true && newCol.className == "partnerColNum3")
            {
                newCol.classList.add("partner-selected")
            }
            if(cCSArray.includes(partnerNameArray[i]) == true && newCol.className == "partnerColNum2")
            {
                newCol.classList.add("partner-selected")
            }
            if(sBSArray.includes(partnerNameArray[i]) == true && newCol.className == "partnerColNum1")
            {
                newCol.classList.add("partner-selected")
            }
            if(sAArray.includes(partnerNameArray[i]) == true && newCol.className == "partnerColNum0")
            {
                newCol.classList.add("partner-selected")
            }
           if(cAArray.includes(partnerNameArray[i]) == true && sVSFArray.includes(partnerNameArray[i]) == true && cCSArray.includes(partnerNameArray[i]) == true && sBSArray.includes(partnerNameArray[i]) == true && sAArray.includes(partnerNameArray[i]) == true)
           {
                newCheckCol.children[0].children[0].checked = true;
           }
        }
    }
    var partnerList = [].slice.call(document.querySelectorAll('#responseTableBody TH'))
    
    partnerList.forEach(function (triggerEl) {
        var tabTrigger = new bootstrap.Tab(triggerEl)
            triggerEl.addEventListener('click', function (event) {
                if(!tabTrigger._element.className.includes("partnerColNum5"))
                {
                    isChecked = tabTrigger._element.parentElement.children[0].children[0].checked;
                    //event.preventDefault()
                    tabTrigger._element.classList.toggle("partner-selected")
                    var picklistClass = tabTrigger._element.classList[0]
                    var picklistSelectedClass = tabTrigger._element.classList[1]
                    var partnerText = tabTrigger._element.textContent
                    toggleClickFunction(tabTrigger._element)
                    if(picklistSelectedClass == "partner-selected")
                    {
                        if(picklistClass == "partnerColNum4")
                        {
                            cAArray.push(partnerText)
                        }
                        else if(picklistClass == "partnerColNum0")
                        {
                            sAArray.push(partnerText)
                        }
                        else if(picklistClass == "partnerColNum1")
                        {
                            sBSArray.push(partnerText)
                        }
                        else if(picklistClass == "partnerColNum2")
                        {
                            cCSArray.push(partnerText)
                        }
                        else if(picklistClass == "partnerColNum3")
                        {
                            sVSFArray.push(partnerText)
                        }
                        else
                        {
                            console.log("Choice Not Caught????")
                        }
                    }
                    else
                    {
                        if(picklistClass == "partnerColNum0")
                        {
                            var filteredElements = sAArray.filter(val => (val != partnerText))
                            sAArray = filteredElements
                        }
                        else if(picklistClass == "partnerColNum1")
                        {
                            var filteredElements = sBSArray.filter(val => (val != partnerText))
                            sBSArray = filteredElements
                        }
                        else if(picklistClass == "partnerColNum2")
                        {
                            var filteredElements = cCSArray.filter(val => (val != partnerText))
                            cCSArray = filteredElements
                        }
                        else if(picklistClass == "partnerColNum3")
                        {
                            var filteredElements = sVSFArray.filter(val => (val != partnerText))
                            sVSFArray = filteredElements
                        }
                        else if(picklistClass == "partnerColNum4")
                        {
                            var filteredElements = cAArray.filter(val => (val != partnerText))
                            cAArray = filteredElements
                        }
                        else
                        {
                            console.log("Choice Not Caught????")
                        }
                    }
                    checkBoxSelection(tabTrigger);
                } else if(tabTrigger._element.className.includes("partnerColNum5")) {
                    //isChecked = tabTrigger._element.children[0].checked;
                    isChecked = tabTrigger._element.children[0].children[0].checked;
                    //var selectedCount = 0;
                    var elems = triggerEl.parentElement.children;
                    var elemsArray = [];
                    if(isChecked == false)
                    {
                        for(let i = 1; i < 6; i++)
                        {
                            elems[i].classList.add("partner-selected")
                            elemsArray.push(elems[i]);
                            //allSelectedArray.push(elems[i]);
                        }
                    }
                    else
                    {
                        for(let i = 1; i < 6; i++)
                        {
                            elems[i].classList.remove("partner-selected");
                            elemsArray.push(elems[i]);
                        }
                    }



                    // for(let i = 1; i < 6; i++)
                    // {
                    //     if(elems[i].classList.contains("partner-selected"))
                    //     {
                    //         selectedCount++
                    //     }
                    //     else
                    //     {
                    //     }
                    // }
                    // if(selectedCount<5)
                    // {
                    //     for(let i = 1; i < 6; i++)
                    //     {
                    //         //elems[i].classList.add("partner-selected")
                    //         elemsArray.push(elems[i])
                    //     }
                    //     tabTrigger._element.children[0].children[0].checked = true;
                    //     console.log("Selected Count: " + selectedCount + " :SELECT ALL TRUE");
                    // }
                    // else
                    // {
                    //     for(let i = 1; i < 6; i++)
                    //     {
                    //         //elems[i].classList.remove("partner-selected")
                    //         elemsArray.push(elems[i])
                    //     }
                    //     tabTrigger._element.children[0].children[0].checked = false;
                    //     console.log("Selected Count: " + selectedCount + " :FALSSSEEE");
                    // }





                    // for(let i = 0; i < elems.length; i++)
                    // {
                    //     //console.log(elems[i])
                    //     if(elems[i].className != "partnerColNum5")
                    //     {
                    //         //elems[i].classList.toggle("partner-selected")
                    //         // console.log("NOT REMOVED")
                    //         // elems[i].classList.add("partner-selected")
                    //         // console.log(elems[i].classList)
                    //         // elemsArray.push(elems[i])
                    //     }
                    // }
                    checkBoxSelection(tabTrigger);
                    toggleClickFunction(elemsArray);
                }
            })

            function checkBoxSelection(tabEl){
                selectedCount = 0;
                elems = tabEl._element.parentElement.children;
                for(let i = 1; i < 6; i++)
                {
                    if(elems[i].classList.contains("partner-selected"))
                    {
                        selectedCount++
                    }
                    else
                    {
                    }
                }
                if(selectedCount==5)
                {
                    tabEl._element.parentElement.children[0].children[0].children[0].checked = true;
                }
                else
                {
                    tabEl._element.parentElement.children[0].children[0].children[0].checked = false;
                }
            }
            function toggleClickFunction(elRow){
                var elArray = []
                if(elRow.length == undefined){
                    elArray.push(elRow)
                }
                else
                {
                    for(let i = 0; i < elRow.length; i++){
                        elArray.push(elRow[i])
                    }
                }
                //PICKLIST NO CHECKBOX 
                for(let i = 0; i < elArray.length; i++){
                    var elClass = elArray[i].className
                    var elTextContent = elArray[i].textContent
                    if(elClass.includes("partner-selected"))
                    {
                        resTableBody.insertBefore(triggerEl.parentElement, resTableBody.firstChild);
                        const count = {};
                        for (const element of allSelectedArray) {
                            if(count[element]) {
                                count[element] += 1;
                            } else {
                                count[element] = 1;
                            }
                        }
                        if(count[elTextContent] < 5 || count[elTextContent] == undefined)
                        {
                            allSelectedArray.push(elTextContent);
                        }
                        
                        if(elClass.includes("partnerColNum0"))
                        {
                            sAArray.push(elTextContent)
                        }
                        else if(elClass.includes("partnerColNum1"))
                        {
                            sBSArray.push(elTextContent)
                        }
                        else if(elClass.includes("partnerColNum2"))
                        {
                            cCSArray.push(elTextContent)
                        }
                        else if(elClass.includes("partnerColNum3"))
                        {
                            sVSFArray.push(elTextContent)
                        }
                        else if(elClass.includes("partnerColNum4"))
                        {
                            cAArray.push(elTextContent)
                        }
                    }
                    else if(!elClass.includes("partner-selected"))
                    {
                        //console.log(...new Set(allSelectedArray));
                        var uniqueArray = [...new Set(allSelectedArray)]
                        allSelectedArray.splice(allSelectedArray.indexOf(elTextContent),1)
                        //console.log("ALL Selected Array: " + allSelectedArray);
                        partnerNameArray.unshift(elTextContent)
                        if(elClass.includes("partnerColNum0"))
                        {
                            var filteredElements = sAArray.filter(val => (val != elTextContent));
                            sAArray = filteredElements;
                        }
                        else if(elClass.includes("partnerColNum1"))
                        {
                            var filteredElements = sBSArray.filter(val => (val != elTextContent))
                            sBSArray = filteredElements
                        }
                        else if(elClass.includes("partnerColNum2"))
                        {
                            var filteredElements = cCSArray.filter(val => (val != elTextContent))
                            cCSArray = filteredElements
                        }
                        else if(elClass.includes("partnerColNum3"))
                        {
                            var filteredElements = sVSFArray.filter(val => (val != elTextContent))
                            sVSFArray = filteredElements
                        }
                        else if(elClass.includes("partnerColNum4"))
                        {
                            var filteredElements = cAArray.filter(val => (val != elTextContent))
                            cAArray = filteredElements
                        }
                        if(!allSelectedArray.includes(elTextContent))
                        {
                            resTableBody.insertBefore(triggerEl.parentElement, resTableBody.children[uniqueArray.length])
                        }
                        else
                        {
                            //console.log("ALLLLLLL*********: " + allSelectedArray);
                        }
                    }
                    else
                    {
                        console.log("something happened")
                    }
                }
            }    
    })
}

function updateButton() {
    var oppId = document.getElementById("oppId").value;
    console.log(oppId);

    var config = {
        Entity:"Deals",
        APIData:{
            "id" : oppId
        }
    }

    let uniqueSA = [...new Set(sAArray)]

    let uniqueSBS = [...new Set(sBSArray)]

    let uniqueCC = [...new Set(cCSArray)]

    let uniqueSV = [...new Set(sVSFArray)]

    let uniqueCA = [...new Set(cAArray)]

    const checkSAForUpdate = (a, b) => {
        if (a.length !== b.length) return false;
        const uniqueValues = new Set([...a, ...b]);
        for (const v of uniqueValues) {
          const aCount = a.filter(e => e === v).length;
          const bCount = b.filter(e => e === v).length;
          if (aCount !== bCount) return false;
        }
        return true;
      }


    const checkSBSForUpdate = (a, b) => {
        if (a.length !== b.length) return false;
        const uniqueValues = new Set([...a, ...b]);
        for (const v of uniqueValues) {
          const aCount = a.filter(e => e === v).length;
          const bCount = b.filter(e => e === v).length;
          if (aCount !== bCount) return false;
        }
        return true;
      }


    const checkCCSForUpdate = (a, b) => {
        if (a.length !== b.length) return false;
        const uniqueValues = new Set([...a, ...b]);
        for (const v of uniqueValues) {
          const aCount = a.filter(e => e === v).length;
          const bCount = b.filter(e => e === v).length;
          if (aCount !== bCount) return false;
        }
        return true;
      }
 

    const checkSVSFForUpdate = (a, b) => {
        if (a.length !== b.length) return false;
        const uniqueValues = new Set([...a, ...b]);
        for (const v of uniqueValues) {
          const aCount = a.filter(e => e === v).length;
          const bCount = b.filter(e => e === v).length;
          if (aCount !== bCount) return false;
        }
        return true;
      }
 

    const checkCAForUpdate = (a, b) => {
        if (a.length !== b.length) return false;
        const uniqueValues = new Set([...a, ...b]);
        for (const v of uniqueValues) {
          const aCount = a.filter(e => e === v).length;
          const bCount = b.filter(e => e === v).length;
          if (aCount !== bCount) return false;
        }
        return true;
      }


      if(checkSAForUpdate(initialSAArray,uniqueSA) == false)
      {
          //console.log("SA NEEDS UPDATE")
        //   console.log("INITIAL: " + initialSAArray)
        //   console.log("SAARRAY: " + uniqueSA)
          config.APIData.Sales_Approved_Partners = uniqueSA
      }
      else
      {
          console.log("SA SAME")
      }


      if(checkSBSForUpdate(initialSBSArray,uniqueSBS) == false)
      {
        //   console.log("SBS NEEDS UPDATE")
        //   console.log("INITIAL: " + initialSBSArray)
        //   console.log("SBSARRAY: " + uniqueSBS)
        config.APIData.Partner_Search_Results = uniqueSBS
      }
      else
      {
          console.log("SBS: SAMEEE")
      }  


      if(checkCCSForUpdate(initialCCSArray,uniqueCC) == false)
      {
        //   console.log("CCS NEEDS UPDATE")
        //   console.log("INITIAL: " + initialCCSArray)
        //   console.log("CCSARRAY: " + uniqueCC)
        config.APIData.Conference_Call_Selected_Partners = uniqueCC

      }
      else
      {
          console.log("CCS: SAMEEE")
      }  


      if(checkSVSFForUpdate(initialSVSFArray,uniqueSV) == false)
      {
        //   console.log("SVS NEEDS UPDATE")
        //   console.log("INITIAL: " + initialSVSFArray)
        //   console.log("SVS: " + uniqueSV)
        config.APIData.Client_Selected_Partner = uniqueSV
      }
      else
      {
          console.log("SVS: SAMEEE")
      }  


      if(checkCAForUpdate(initialCAArray,uniqueCA) == false)
      {
        //   console.log("CA NEEDS UPDATE")
        //   console.log("INITIAL: " + initialCAArray)
        //   console.log("CAARRAY: " + uniqueCA)
        config.APIData.Correct_Client_Approved_Vendors = uniqueCA
      }
      else
      {
          console.log("CA: SAMEEE")
      }
      console.log(config)
      ZOHO.CRM.API.updateRecord(config)
      .then(function(data){
          console.log(data)
      });
      ZOHO.CRM.UI.Popup.closeReload()
      .then(function(data){
          console.log(data)
          console.log("triggered close and reload popup")
      });
}




$(document).ready(function(){
    $("#tableSearch").on("keyup", function() {
      var value = $(this).val().toLowerCase();
      //var checkEl = document.getElementsByClassName("partnerCol5")
      $("#responseTableBody th").filter(function() {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        if($(this)[0].style.display != "none")
        {
            $(this)[0].parentElement.getElementsByClassName("partnerColNum5")[0].style = 'display'
        }
      });
    });
});

















//################################################
//Prod Version Below
//################################################
/*
ZOHO.embeddedApp.on("PageLoad", entity => {
    var moduleName = entity.Entity;
    var recordId = entity.EntityId; 
    ZOHO.CRM.API.getRecord({Entity: moduleName, RecordID: recordId})
    .then(function (recordData) {
        recordData = recordData.data[0];
        dealName = recordData.Deal_Name;
        document.getElementById("oppId").value = recordData.id;
        allRecordData = recordData;
        getPartners();
        console.log(recordData)
    });    
});
ZOHO.embeddedApp.init();



function getPartners() {
    ZOHO.CRM.API.searchRecord({Entity:"Vendors",Type:"criteria",Query:"(Status:equals:CCCA Executed)",per_page:200,page:pageNumber})
    .then(function(response){
        var allPartnerRecs = response.data;
        allPartnerRecs.forEach(obj => {
            partnerNameArray.push(obj.Vendor_Name);
        });
        if(response.info.more_records == true)
        {
            pageNumber += 1;
            return getPartners();
        }
        else
        {
            createPartnerTable();
            console.log(partnerNameArray);
        }
    });
};





function createPartnerTable() {
    partnerNameArray.sort();
    var resTableBody = document.getElementById("responseTableBody");
    for (let i = 0; i < partnerNameArray.length; i++){
        var newRow = document.createElement("TR");
        var newCol = document.createElement("TH");
        newCol.setAttribute("class","partnerColNum");
        newCol.innerHTML = partnerNameArray[i];
        newRow.appendChild(newCol);
        resTableBody.appendChild(newRow);
    }
    var partnerList = [].slice.call(document.querySelectorAll('#responseTableBody TH'))
    partnerList.forEach(function (triggerEl) {
        var tabTrigger = new bootstrap.Tab(triggerEl)
        triggerEl.addEventListener('click', function (event) {
            event.preventDefault()
            tabTrigger._element.classList.toggle("partner-selected")
        })
    })
}


function createPartnerTable() {
    partnerNameArray.sort();
    console.log(partnerNameArray)
    
    var resTableBody = document.getElementById("responseTableBody");
    for (let i = 0; i < partnerNameArray.length; i++){
        var newRow = document.createElement("TR");
        for(let x = 0; x < 5; x++){
            var newCol = document.createElement("TH");
            newCol.setAttribute("class","partnerColNum" + x);
            newCol.innerHTML = partnerNameArray[i];
            newRow.appendChild(newCol);
            resTableBody.appendChild(newRow);
        }
    }
    console.log(resTableBody);
    var partnerList = [].slice.call(document.querySelectorAll('#responseTableBody TH'))
    partnerList.forEach(function (triggerEl) {
        var tabTrigger = new bootstrap.Tab(triggerEl)
        triggerEl.addEventListener('click', function (event) {
            event.preventDefault()
            tabTrigger._element.classList.toggle("partner-selected")
            var picklistClass = tabTrigger._element.classList[0]
            var picklistSelectedClass = tabTrigger._element.classList[1]
            var partnerText = tabTrigger._element.textContent
            if(picklistSelectedClass == "partner-selected")
            {
                if(picklistClass == "partnerColNum0")
                {
                    sAArray.push(partnerText)
                }
                else if(picklistClass == "partnerColNum1")
                {
                    sBSArray.push(partnerText)
                }
                else if(picklistClass == "partnerColNum2")
                {
                    cCSArray.push(partnerText)
                }
                else if(picklistClass == "partnerColNum3")
                {
                    sVSFArray.push(partnerText)
                }
                else if(picklistClass == "partnerColNum4")
                {
                    cAArray.push(partnerText)
                }
                else
                {
                    console.log("Choice Not Caught????")
                }
            }
            else
            {
                if(picklistClass == "partnerColNum0")
                {
                    var filteredElements = sAArray.filter(val => (val != partnerText))
                    sAArray = filteredElements
                }
                else if(picklistClass == "partnerColNum1")
                {
                    var filteredElements = sBSArray.filter(val => (val != partnerText))
                    sBSArray = filteredElements
                }
                else if(picklistClass == "partnerColNum2")
                {
                    var filteredElements = cCSArray.filter(val => (val != partnerText))
                    cCSArray = filteredElements
                }
                else if(picklistClass == "partnerColNum3")
                {
                    var filteredElements = sVSFArray.filter(val => (val != partnerText))
                    sVSFArray = filteredElements
                }
                else if(picklistClass == "partnerColNum4")
                {
                    var filteredElements = cAArray.filter(val => (val != partnerText))
                    cAArray = filteredElements
                }
                else
                {
                    console.log("Choice Not Caught????")
                }
            }
        })
    })
}

var triggerTabList = [].slice.call(document.querySelectorAll('#partnerButtons a'))
triggerTabList.forEach(function (triggerEl) {
    var tabTrigger = new bootstrap.Tab(triggerEl)
    triggerEl.addEventListener('click', function (event) {
        event.preventDefault()
        tabTrigger._element.classList.toggle("partner-button")
    })
})

function updatePartnerPicklist() {
    //var recId = document.getElementById("oppId").value
    partnersArray = [];
    var config={
        Entity:"Deals",
        APIData:{
            "id" : "1190034000100993270"
        }
    }
    var activePartners = [].slice.call(document.querySelectorAll(".partner-selected"))
    activePartners.forEach(function (partnerEl) {
        partnersArray.push(partnerEl.innerHTML)
    })
    var activePartnerPicklist = [].slice.call(document.querySelectorAll(".partner-button"))
    activePartnerPicklist.forEach(function (picklistEl) {
        var picklistItem = picklistEl.innerHTML
        if(picklistItem == "Sales Approved Partners")
        {
            config.APIData.Sales_Approved_Partners = partnersArray
        }
        else if(picklistItem == "SBS Selected Partners")
        {
            config.APIData.Partner_Search_Results = partnersArray
        }
        else if(picklistItem == "Conference Call Selected Partners")
        {
            config.APIData.Conference_Call_Selected_Partners = partnersArray
        }
        else if(picklistItem == "Site Visit Selected Finalist")
        {
            config.APIData.Client_Selected_Partner = partnersArray
        }
        else if(picklistItem == "Client Approved Partner")
        {
            config.APIData.Correct_Client_Approved_Vendors = partnersArray
        }
        else
        {
        }
    })
    ZOHO.CRM.API.updateRecord(config)
    .then(function(data){
        console.log(data)
    });
}


$(document).ready(function(){
    $("#tableSearch").on("keyup", function() {
      var value = $(this).val().toLowerCase();
      $("#responseTableBody th").filter(function() {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
      });
    });
});
*/

